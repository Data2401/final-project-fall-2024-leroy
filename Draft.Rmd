---
title: "FIFA WORLD CUP"
author: "Leroy Ozores"
output:
  slidy_presentation:
    highlight: default
  powerpoint_presentation: default
  beamer_presentation:
    highlight: default
---
```{r setup, include=FALSE, message = F}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(plotly)
library(ggplot2)

#Packages Required

tuesdata <- tidytuesdayR::tt_load('2022-11-29')
tuesdata <- tidytuesdayR::tt_load(2022, week = 48)

wcmatches <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-11-29/wcmatches.csv')
worldcups <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-11-29/worldcups.csv')
```

# Introduction

The data that I will be using comes from FIFA, "Fédération Internationale de Football Association", which translates to,  *International Federation of Association Football*.  This dataset collects data from `r nrow(wcmatches)` World Cup matches that was played in its history from Uruguay in 1930 to Russia in 2018. 
This data collected from [Kaggle](https://github.com/rfordatascience/tidytuesday/tree/master/data/2022/2022-11-29).

# When was the First Match from the data?
```{r}
wcmatches %>% 
  select(year, stage, date, home_team, away_team, outcome) %>% 
  filter(date == min(date)) %>% knitr::kable()
```
# When was the most recent match from the data?
```{r}
wcmatches %>% 
  select(year, stage, date, home_team, away_team, outcome) %>% 
  filter(date == max(date)) %>% knitr::kable()
```

# Attendance Rate

How popular is the FIFA World Cup? How many attended? Which year had the highest amount of audience?

```{r echo = F}
top3 <- worldcups %>% 
  select(year, host, attendance, games, winner) %>% 
  slice_max(n = 3, order_by = attendance)
knitr::kable(top3)

```

```{r}
attend_graph <- ggplot(worldcups, aes(x = year, y = attendance, fill = host,  text = paste("Host: ", host))) +
  geom_bar(stat = "identity") +
  labs(title = "Attendance Rate",
       subtitle = "1930 - 2018")

ggplotly(attend_graph)
```

# Attendace Rate, pt2

```{r}
q <- worldcups %>% 
  ggplot() +
  aes(x = reorder(year, attendance),
      y = attendance,
      fill = host) +
  geom_col() +
  coord_flip() +
  labs(title = "Ranking from Highest to lowest",
       y = "Amount of Audience",
       x = "Year of Tournament")

ggplotly(q)
```

# Has USA won the FIFA World Cup? Or close to reaching the FIFA  Cup?

```{r}
filter(worldcups, winner == "USA" | second == "USA" | third == "USA" | fourth == "USA") %>% 
  knitr::kable()

```



# Who was won the FIFA World Cup?

```{r}
worldcups %>% 
  distinct(winner) %>% knitr::kable()
```


# FIFA World Cup Winners count

```{r}
Wins <- worldcups %>% 
  ggplot() +
  aes(x = winner, 
      fill = winner) +
  geom_bar() +
  labs(title = "Championship Winners!")
ggplotly(Wins)
```


# Most Goals
Every match is exciting, especially when your team scores. Every one standing up screaming Gol, bumping to each other and even spealing our drinks to our neighbor. How many gols screams are there per game?

```{r}
wcmatches <- wcmatches %>% 
  mutate(Total_Gols = home_score + away_score) %>% 
  select(year, stage, home_team, away_team, home_score, away_score, Total_Gols, everything())

wcmatches %>%
  select(year, stage, winning_team, away_team, Total_Gols) %>% 
  knitr::kable()

```

# Ranked Most to Least amount of gols in a match.

```{r}
wcmatches %>% 
  group_by(date, winning_team) %>% 
  select(date, home_team, away_team, winning_team, Total_Gols) %>% 
  head(20) %>% 
  arrange(-Total_Gols) %>% knitr::kable() 
```


# How many Gols per year occur?
```{r}
v <- wcmatches %>% 
  group_by(year) %>% 
  summarise(Total_Gols = sum(Total_Gols)) %>% 
  ggplot(aes(x = year, y = Total_Gols)) +
  geom_bar(colour = "red", fill = "white", stat = "identity", linewidth = 5) +
  geom_text(aes(label = Total_Gols), vjust = 0) +
  labs(title = "Total Goals for every Quadrennial Tournament",
       x = "Year", 
       y = "Total of Goals Scored")
ggplotly(v)

```
 
# Which Team has scored more goals?

```{r}
wcmatches %>%
  group_by(home_team) %>% 
  summarise(home_score = sum(home_score), n_home = n()) -> set1

wcmatches %>% 
  group_by(away_team) %>%
  summarise(away_score = sum(away_score), n_away = n()) -> set2

inner_join(set1, set2, join_by("home_team" == "away_team")) %>% 
  mutate(total_goals = home_score + away_score) %>%
  select(team = home_team, total_goals) %>%
  head(10) %>% 
  arrange(-total_goals) %>% knitr::kable()

```

# Has any match end in extra time or penalties?

```{r}
wcmatches %>%
  na.omit() %>% 
  select(year, home_team, away_team, win_conditions) %>% 
  knitr::kable()
```


# How many matches played After Extra Time?
```{r}
AET <- wcmatches %>% 
  filter(grepl("AET", win_conditions)) %>% 
  select(year, stage, win_conditions) %>% 
  arrange(year) %>% knitr::kable()
AET
```

# How many matches made it to the Penalties stage?
```{r}
penalties <- wcmatches %>% 
  filter(grepl("penalties", win_conditions)) %>% 
  select(year, stage, win_conditions) %>% 
  arrange(year)
penalties %>% knitr::kable()

```

# All Together

```{r}
wcmatches <- wcmatches %>% 
  mutate(Type_of_Win = str_extract(win_conditions, "\\b(AET|penalties)\\b"))

Overall <- wcmatches %>% 
  na.omit() %>% 
  ggplot(aes(x = Type_of_Win, fill = Type_of_Win)) +
  geom_bar() +
  labs(title = "After Extra Time & penalties",
       x = " ", 
       y = " ")

ggplotly(Overall)
```

# Matches during the week

```{r}
#Days <- wcmatches %>% 
 # mutate(weekdays = dayofweek(dates, label = TRUE)) %>% 
 # ggplot(aes(x = weekdays, fill = dayofweek)) +
  #geom_bar() +
#  facet_wrap(~ year) +
 # coord_flip() +
  #labs(title = "Match Day Per Quadrennial Tournament",
   #    subtitle = "Which Day had the most matches?",
    #   y = "Year",
     #  x = "Weekday")

#ggplotly(Days)

```

# Which teams have made it to the SemiFinal?

```{r}
wcmatches %>% 
  filter(stage == "Semifinals") %>% 
  select(year, stage, home_team, away_team) %>% knitr::kable()
```

 
